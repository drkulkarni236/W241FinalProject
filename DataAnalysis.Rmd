---
title: "Data Analysis"
author: "Ryan Wilson, Sumedh Shah, Devashish Kulkarni"
date: "11/27/2022"
output: 
  pdf_document: 
    number_sections: true
---
```{r global options, include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, tidy.opts = list(width.cutoff = 60), tidy = TRUE )

knitr::knit_engines$set(problem_description = function(options) {
  code <- paste(options$code, collapse = "\n")
})
```

```{r package loads, include = FALSE, warning=FALSE, message=FALSE}
library(data.table)
library(sandwich)
library(lmtest)
library(stargazer) 

library(ggplot2)
library(knitr)

set.seed(42)
```



```{r read data, include=TRUE}
d <- fread('w241_project_dataset.csv')
nrow(d)

# Remove rows (only 2) with NA
d <- na.omit(d)
nrow(d)

# Replace 'DATA_EXPIRED' and 'CONSENT_REVOKED' values with 'Unavailable'
d[d == 'DATA_EXPIRED'] <- 'Unavailable'
d[d == 'CONSENT_REVOKED'] <- 'Unavailable'

head(d)
```

```{r explore data, include=TRUE}

# Split data table by treatment value
d_treatment <- d[treatment==1,]
d_control <- d[treatment==0,]
head(d_control)



# Unique values and counts

# Sex
d[, .(count = .N), by = sex]

# Ethnicity
d[, .(count = .N), by = ethnicity]

# Score
d[, .(count = .N), by = score]

# Age
d[, .(count = .N), by = age]

# Treatment
d[, .(count = .N), by = treatment]

# Hist of scores
hist(d_control$score)
hist(d_treatment$score)

# Hist of num questions completed
hist(d_control$num_completed)
hist(d_treatment$num_completed)
```

# Regressions

```{r regressions for score outcome, include=TRUE}

# Basic regression
mod_basic <- lm(score ~ treatment , d)
coeftest(mod_basic, vcov. = vcovHC(mod_basic),type='HC1')
stargazer(mod_basic,type='text')

# Second regression
mod_sex <- lm(score ~ treatment + ethnicity, d)
coeftest(mod_sex, vcov. = vcovHC(mod_sex),type='HC1')
stargazer(mod_sex,type='text')


# Third regression
mod_mult <- lm(score ~ treatment + ethnicity + sex, d)
coeftest(mod_mult, vcov. = vcovHC(mod_mult),type='HC1')
stargazer(mod_mult,type='text')

# Fourth regression (interaction term)
mod_interaction <- lm(score ~ treatment + ethnicity + sex + ethnicity*sex, d)
coeftest(mod_interaction, vcov. = vcovHC(mod_interaction),type='HC1')
stargazer(mod_interaction,type='text')
    
# Fifth regression
mod5 <- lm(score ~ treatment + sex + treatment*sex, d)
coeftest(mod5, vcov. = vcovHC(mod5),type='HC1')
stargazer(mod5,type='text')

# Sixth regression
mod6 <- lm(score ~ treatment + ethnicity + treatment*ethnicity, d)
coeftest(mod6, vcov. = vcovHC(mod6),type='HC1')
stargazer(mod6,type='text')
```



```{r regressions for num completed outcome, include=TRUE}

# Basic regression
mod2_basic <- lm(num_completed ~ treatment, d)
coeftest(mod2_basic, vcov. = vcovHC(mod2_basic),type='HC1')
stargazer(mod2_basic,type='text')

# Second regression
mod2_sex <- lm(num_completed ~ treatment + ethnicity, d)
coeftest(mod2_sex, vcov. = vcovHC(mod2_sex),type='HC1')
stargazer(mod2_sex,type='text')


# Third regression
mod2_mult <- lm(num_completed ~ treatment + ethnicity + sex, d)
coeftest(mod2_mult, vcov. = vcovHC(mod2_mult),type='HC1')
stargazer(mod2_mult,type='text')


# Fourth regression (interaction term)
mod2_interaction <- lm(num_completed ~ treatment + ethnicity + sex + ethnicity*sex, d)
coeftest(mod2_interaction, vcov. = vcovHC(mod2_interaction),type='HC1')
stargazer(mod2_interaction,type='text')
    


```

